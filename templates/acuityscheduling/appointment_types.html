{% extends 'base.html' %}

{% block content %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Appointment Types</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <style>
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0px 8px 20px rgba(0, 0, 0, 0.2);
    }
    .loading-spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-left-color: #2563eb;
      border-radius: 50%;
      width: 2rem;
      height: 2rem;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>
<body class="bg-gradient-to-b from-gray-100 to-gray-200 min-h-screen py-10 flex flex-col items-center">

  <!-- Page Heading -->
  <h1 class="text-5xl font-bold text-blue-600 mb-8 text-center drop-shadow-md">Appointment Types</h1>

  <!-- Search and Filters -->
  <div class="bg-white shadow-lg rounded-lg p-6 mb-8 space-y-4 w-full max-w-6xl">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
      <!-- Search by Name or Price -->
      <input
        id="search-bar"
        type="text"
        placeholder="Search by name or price..."
        oninput="filterResults()"
        class="col-span-2 border border-gray-300 rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
      />

      <!-- Min-Max Duration -->
      <div class="flex items-center gap-4 col-span-2">
        <div class="w-1/2">
          <label for="min-duration" class="block text-gray-700 text-sm font-medium">Min Duration</label>
          <input
            id="min-duration"
            type="number"
            placeholder="Min"
            oninput="filterResults()"
            class="w-full border border-gray-300 rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>
        <div class="w-1/2">
          <label for="max-duration" class="block text-gray-700 text-sm font-medium">Max Duration</label>
          <input
            id="max-duration"
            type="number"
            placeholder="Max"
            oninput="filterResults()"
            class="w-full border border-gray-300 rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>
      </div>
    </div>

    <!-- Color Filter -->
    <div class="flex gap-4 mt-4">
      {% for color in colors %}
        <div
          class="w-8 h-8 rounded-full cursor-pointer border-2 border-gray-300 hover:border-blue-500"
          style="background-color: {{ color }}"
          onclick="filterByColor('{{ color }}')"
        ></div>
      {% endfor %}
      <button
        onclick="filterByColor('')"
        class="w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center hover:border-blue-500"
      >
        <i class="fas fa-times text-gray-500"></i>
      </button>
    </div>
  </div>

  {% if error %}
    <!-- Error Alert -->
    <div class="bg-red-100 text-red-800 border border-red-400 rounded-lg px-4 py-3 mb-6">
      <div class="flex items-center space-x-2">
        <i class="fas fa-exclamation-triangle text-red-600"></i>
        <span>{{ error }}</span>
      </div>
    </div>
  {% else %}
    <!-- Appointment Types List -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 w-full max-w-6xl">
      {% for appt_type in appointment_types %}
        <div
          class="bg-white shadow-lg rounded-lg p-6 card hover:shadow-xl hover:scale-105 transition-transform"
          style="border-left: 4px solid {{ appt_type.color }}"
          data-name="{{ appt_type.name }}"
          data-duration="{{ appt_type.duration }}"
          data-price="{{ appt_type.price }}"
          data-color="{{ appt_type.color }}"
        >
          <h2 class="text-2xl font-bold text-gray-800">{{ appt_type.name }}</h2>
          <p class="text-gray-600"><strong>Duration:</strong> {{ appt_type.duration }} minutes</p>
          <p class="text-gray-600"><strong>Price:</strong> â‚¹{{ appt_type.price }}</p>
          <div class="mt-6 flex justify-between">
            <button
              class="btn flex items-center space-x-2 bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300 transition relative"
              onclick="navigator.clipboard.writeText('{{ appt_type.link }}'); showToast('Link copied to clipboard!', 'success')">
              <i class="fas fa-copy"></i>
              <span>Copy Link</span>
            </button>
            <button
              class="btn flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition relative"
              onclick="window.open('{{ appt_type.link }}', '_blank')">
              <i class="fas fa-external-link-alt"></i>
              <span>Open</span>
            </button>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <script>
    function filterResults() {
      const query = document.getElementById("search-bar").value.toLowerCase();
      const minDuration = parseInt(document.getElementById("min-duration").value) || 0;
      const maxDuration = parseInt(document.getElementById("max-duration").value) || Infinity;

      const cards = document.querySelectorAll(".card");
      cards.forEach(card => {
        const name = card.dataset.name.toLowerCase();
        const price = parseFloat(card.dataset.price);
        const duration = parseInt(card.dataset.duration);

        if (
          (query === "" || name.includes(query) || price.toString().includes(query)) &&
          duration >= minDuration &&
          duration <= maxDuration
        ) {
          card.classList.remove("hidden");
        } else {
          card.classList.add("hidden");
        }
      });
    }

    function filterByColor(color) {
      const cards = document.querySelectorAll(".card");
      cards.forEach(card => {
        const cardColor = card.dataset.color;
        if (color === "" || cardColor === color) {
          card.classList.remove("hidden");
        } else {
          card.classList.add("hidden");
        }
      });
    }

    function showToast(message, type) {
      const toast = document.createElement("div");
      toast.className = `fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white ${
        type === "success" ? "bg-green-500" : "bg-red-500"
      }`;
      toast.innerText = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }
  </script>
</body>
</html>

{% endblock %}
